::: {.cell .markdown}### Execute Experiment:::::: {.cell .code}```python# nodes and instancestx0_node = slice.get_node(name="tx0")tx1_node = slice.get_node(name="tx1")rx0_node = slice.get_node(name="rx0")rx1_node = slice.get_node(name="rx1")delay_node = slice.get_node(name="delay")router_node = slice.get_node(name="router")tx0_egress_iface  = tx0_node.get_interface(network_name = "net-tx")tx1_egress_iface  = tx1_node.get_interface(network_name = "net-tx")delay_ingress_tx0_iface  = delay_node.get_interface(network_name = "net-tx")delay_ingress_tx1_iface  = delay_node.get_interface(network_name = "net-tx")delay_egress_iface  = delay_node.get_interface(network_name = "net-mid")delay_ingress_tx0_name = delay_ingress_tx0_iface.get_device_name()delay_ingress_tx1_name = delay_ingress_tx1_iface.get_device_name()delay_egress_name = delay_egress_iface.get_device_name()router_ingress_iface  = router_node.get_interface(network_name = "net-mid")router_egress_iface  = router_node.get_interface(network_name = "net-tx")router_egress_name  = router_egress_iface.get_device_name()rx0_ingress_iface  = rx0_node.get_interface(network_name = "net-tx")rx1_ingress_iface  = rx1_node.get_interface(network_name = "net-tx")```:::::: {.cell .code}```python# generate full factorial experimentimport itertoolsexp_factors = {     'n_bdp': [0.5, 2, 5, 10], # n x bandwidth delay product    'btl_capacity': [100, 1000],    'base_rtt': [10, 50, 100],    'aqm': ['FIFO', 'single queue FQ', 'Codel', 'FQ', 'FQ_Codel', 'DualPI2'],    'ecn_threshold': [5, 20],    'ecn_fallback': ['off', 'on'],    'rx0_ecn': [0, 1, 2] #0: noecn, 1:ecn, 2:accecn    'rx1_ecn': [0, 1, 2]  #0: noecn, 1:ecn, 2:accecn}factor_names = [k for k in exp_factors]factor_lists = list(itertools.product(*exp_factors.values()))exp_lists = []for factor_l in factor_lists:    temp_dict = dict(zip(factor_names, factor_l))    if temp_dict['aqm'] == 'FIFO':        del temp_dict['ecn_threshold']    exp_lists.append(temp_dict)data_dir = slice_name + 'singlebottleneck'```:::::: {.cell .code}```python# delay at emulatorem = [    {"name": "delay", "if": "switch_1-client_A-switch_1_switch_1-p1"},    {"name": "delay", "if": "switch_1-client_B-switch_1_switch_1-p1"},    {"name": "delay", "if": "switch_1-switch_1-router_switch_1-p1"},]for e in em:    os_if_name = slice.get_interface(name=e['if']).get_os_interface()    cmds = "sudo tc qdisc replace dev {iface} root netem delay {owd}ms limit 60000".format(iface=os_if_name, owd=base_owd)    slice.get_node(name=e["name"]).execute(cmds)```:::::: {.cell .code}```python# run experimentsem = ['delay_ingress_tx0_name', 'delay_ingress_tx1_name', 'delay_egress_name']commands_noecn='''sudo sysctl -w net.ipv4.tcp_congestion_control=cubic  sudo sysctl -w net.ipv4.tcp_ecn=0''' #tcp_prague, no ECNcommands_ecn='''sudo sysctl -w net.ipv4.tcp_congestion_control=cubic  sudo sysctl -w net.ipv4.tcp_ecn=1''' #tcp_prague, ECNcommands_accecn='''sudo sysctl -w net.ipv4.tcp_congestion_control=prague  sudo sysctl -w net.ipv4.tcp_ecn=3''' #tcp_prague, AccECNserver_ecn_list=[ommands_noecn, commands_ecn, commands_accecn]for exp in exp_lists:    # check if we already ran this experiment    # (allow stop/resume)    file_out = data_dir + "/%d_%d_%d_%s_%d_%s_%s_%s.txt" % (exp['n_bdp'], exp['btl_capacity'], exp['base_rtt'], exp['aqm'], exp['ecn_threshold'], exp['ecn_fallback'], exp['rx0_ecn'], exp['rx1_ecn'])    stdout, stderr = tx_node.execute("ls " + file_out, quiet=True) # run this on the node that saves the output file    if len(stdout):        print("Already have " + file_out + ", skipping")    elif len(stderr):        print("Running experiment to generate " + file_out)                 # delay at emulator        for e in em:            cmds = "sudo tc qdisc replace dev {iface} root netem delay {owd}ms limit 60000".format(iface=e, owd=exp['base_rtt'])            slice.get_node(name=e["name"]).execute(cmds)                # fixed values        btl_limit    = int(1000*exp['n_bdp']*exp['btl_capacity']*2*exp['base_rtt']/8) # limit of the bottleneck, n_bdp x BDP in bytes         packet_number=int(btl_limit/1500)+1                #receiver ecn configuration        rx0_node.execute(server_ecn_list[exp['rx0_ecn']])        rx1_node.execute(server_ecn_list[exp['rx1_ecn']])                #aqm type selection        if exp['aqm']=='FIFO'            cmds = '''            sudo tc qdisc del dev {iface} root            sudo tc qdisc replace dev {iface} root handle 1: htb default 3             sudo tc class add dev {iface} parent 1: classid 1:3 htb rate {capacity}mbit             sudo tc qdisc add dev {iface} parent 1:3 handle 3: bfifo limit {buffer}             '''.format(iface=router_egress_name, capacity=exp['btl_capacity'], buffer=btl_limit)            router_node.execute(cmds)                elif exp['aqm']=='single queue FQ'            cmds = '''            sudo tc qdisc del dev {iface} root            sudo tc qdisc replace dev {iface} root handle 1: htb default 3            sudo tc class add dev {iface} parent 1: classid 1:3 htb rate {capacity}mbit            sudo tc qdisc replace dev {iface} parent 1:3 handle 3: fq limit {packet_limit} flow_limit {packet_limit} orphan_mask 0 ce_threshold {threshold}ms            '''.format(iface=router_egress_name, capacity=exp['btl_capacity'], packet_limit=packet_number, threshold=exp['ecn_threshold'])            router_node.execute(cmds)                                elif exp['aqm']=='Codel'            cmds = '''            sudo tc qdisc del dev {iface} root            sudo tc qdisc replace dev {iface} root handle 1: htb default 3            sudo tc class add dev {iface} parent 1: classid 1:3 htb rate {capacity}mbit            sudo tc qdisc replace dev {iface} parent 1:3 handle 3: codel limit {packet_limit} target {target}ms interval 100ms ecn ce_threshold {threshold}ms            '''.format(iface=router_egress_name, capacity=exp['btl_capacity'], packet_limit=packet_number, target=exp['base_rtt']*exp['n_bdp'], threshold=exp['ecn_threshold'])            router_node.execute(cmds)                                elif exp['aqm']=='FQ'            cmds = '''            sudo tc qdisc del dev {iface} root            sudo tc qdisc replace dev {iface} root handle 1: htb default 3            sudo tc class add dev {iface} parent 1: classid 1:3 htb rate {capacity}mbit            sudo tc qdisc replace dev {iface} parent 1:3 handle 3: fq limit {packet_limit} flow_limit {packet_limit} ce_threshold {threshold}ms            '''.format(iface=router_egress_name, capacity=exp['btl_capacity'], packet_limit=packet_number, threshold=exp['ecn_threshold'])            router_node.execute(cmds)                                elif exp['aqm']=='FQ_Codel'            cmds = '''            sudo tc qdisc del dev {iface} root            sudo tc qdisc replace dev {iface} root handle 1: htb default 3            sudo tc class add dev {iface} parent 1: classid 1:3 htb rate {capacity}mbit            sudo tc qdisc replace dev {iface} parent 1:3 handle 3: fq_codel limit {packet_limit} target {target}ms interval 100ms ecn ce_threshold {threshold}ms            '''.format(iface=router_egress_name, capacity=exp['btl_capacity'], packet_limit=packet_number, target=exp['base_rtt']*exp['n_bdp'], threshold=exp['ecn_threshold'])            router_node.execute(cmds)                elif exp['aqm']=='DualPI2'            cmds = '''            sudo tc qdisc del dev {iface} root            sudo tc qdisc replace dev {iface} root handle 1: htb default 3            sudo tc class add dev {iface} parent 1: classid 1:3 htb rate {capacity}mbit            sudo tc qdisc add dev {iface} parent 1:3 handle 3: dualpi2 target {threshold}ms            '''.format(iface=router_egress_name, capacity=exp['btl_capacity'], threshold=exp['ecn_threshold'])            router_node.execute(cmds)                        #                                                                                                                                                                                                                             ``````:::